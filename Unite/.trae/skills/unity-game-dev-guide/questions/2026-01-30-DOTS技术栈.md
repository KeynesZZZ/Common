---
title: "DOTS æŠ€æœ¯æ ˆ"
date: "2026-01-30"
tags: [Unity, C#, DOTS, ECS, æ€§èƒ½ä¼˜åŒ–]
---

# DOTS æŠ€æœ¯æ ˆ

## é—®é¢˜æè¿°
> DOTS æŠ€æœ¯æ ˆ

## å›ç­”

### 1. é—®é¢˜åˆ†æ
**æŠ€æœ¯èƒŒæ™¯**ï¼š
- DOTSï¼ˆData-Oriented Technology Stackï¼‰æ˜¯ Unity çš„é«˜æ€§èƒ½ç¼–ç¨‹æ¡†æ¶
- åŒ…å«ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šECSï¼ˆEntity Component Systemï¼‰ã€Job Systemã€Burst Compiler
- æ—¨åœ¨è§£å†³ä¼ ç»Ÿ OOP æ¶æ„åœ¨æ¸¸æˆå¼€å‘ä¸­çš„æ€§èƒ½ç“¶é¢ˆ

**æ ¹æœ¬åŸå› **ï¼š
- ä¼ ç»Ÿ MonoBehaviour æ¶æ„å­˜åœ¨ç¼“å­˜ä¸å‹å¥½ã€GC å‹åŠ›å¤§ã€å•çº¿ç¨‹é™åˆ¶ç­‰é—®é¢˜
- é¢å‘å¯¹è±¡è®¾è®¡å¯¼è‡´æ•°æ®åˆ†æ•£ï¼Œä¸åˆ©äº CPU ç¼“å­˜
- éœ€è¦ä¸€ç§é¢å‘æ•°æ®çš„æ¶æ„æ¥å……åˆ†åˆ©ç”¨ç°ä»£ç¡¬ä»¶

**è§£å†³æ–¹æ¡ˆæ¦‚è¿°**ï¼š
- ä½¿ç”¨ ECS æ¶æ„ç»„ç»‡æ•°æ®ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡
- ä½¿ç”¨ Job System å®ç°å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†
- ä½¿ç”¨ Burst Compiler ç¼–è¯‘é«˜æ€§èƒ½åŸç”Ÿä»£ç 

### 2. æ¡ˆä¾‹æ¼”ç¤º
**åŸºç¡€ ECS ç¤ºä¾‹**ï¼š
```csharp
using Unity.Burst;
using Unity.Collections;
using Unity.Entities;
using Unity.Mathematics;
using Unity.Transforms;
using UnityEngine;

// ç»„ä»¶å®šä¹‰ï¼ˆçº¯æ•°æ®ï¼‰
public struct MovementData : IComponentData
{
    public float3 Direction;
    public float Speed;
}

public struct RotationData : IComponentData
{
    public float RotationSpeed;
}

// ç³»ç»Ÿå®šä¹‰ï¼ˆè¡Œä¸ºé€»è¾‘ï¼‰
[BurstCompile]
public partial struct MovementSystem : ISystem
{
    public void OnCreate(ref SystemState state)
    {
        // ç³»ç»Ÿåˆå§‹åŒ–
    }

    public void OnDestroy(ref SystemState state)
    {
        // ç³»ç»Ÿé”€æ¯
    }

    [BurstCompile]
    public void OnUpdate(ref SystemState state)
    {
        float deltaTime = SystemAPI.Time.DeltaTime;
        
        // æŸ¥è¯¢æ‰€æœ‰å…·æœ‰ LocalTransform å’Œ MovementData çš„å®ä½“
        foreach (var (transform, movement) in 
            SystemAPI.Query<RefRW<LocalTransform>, RefRO<MovementData>>())
        {
            // æ›´æ–°ä½ç½®
            float3 newPosition = transform.ValueRO.Position + 
                movement.ValueRO.Direction * movement.ValueRO.Speed * deltaTime;
            
            transform.ValueRW.Position = newPosition;
        }
    }
}

// MonoBehaviour ç”¨äºåœ¨åœºæ™¯ä¸­åˆ›å»º DOTS å®ä½“
public class DOTSSpawner : MonoBehaviour
{
    [SerializeField] private GameObject prefab;
    [SerializeField] private int spawnCount = 1000;
    
    void Start()
    {
        // è·å–å®ä½“ç®¡ç†å™¨
        var entityManager = World.DefaultGameObjectInjectionWorld.EntityManager;
        
        // åˆ›å»ºå®ä½“åŸå‹
        var entityPrefab = entityManager.CreateEntity();
        entityManager.AddComponent<LocalTransform>(entityPrefab);
        entityManager.AddComponent<MovementData>(entityPrefab);
        entityManager.AddComponent<RotationData>(entityPrefab);
        
        // æ‰¹é‡åˆ›å»ºå®ä½“
        NativeArray<Entity> entities = new NativeArray<Entity>(spawnCount, Allocator.Temp);
        entityManager.Instantiate(entityPrefab, entities);
        
        // åˆå§‹åŒ–å®ä½“æ•°æ®
        for (int i = 0; i < spawnCount; i++)
        {
            entityManager.SetComponentData(entities[i], new MovementData
            {
                Direction = new float3(
                    UnityEngine.Random.Range(-1f, 1f),
                    0,
                    UnityEngine.Random.Range(-1f, 1f)
                ),
                Speed = UnityEngine.Random.Range(1f, 5f)
            });
            
            entityManager.SetComponentData(entities[i], new RotationData
            {
                RotationSpeed = UnityEngine.Random.Range(10f, 100f)
            });
            
            entityManager.SetComponentData(entities[i], new LocalTransform
            {
                Position = new float3(
                    UnityEngine.Random.Range(-50f, 50f),
                    0,
                    UnityEngine.Random.Range(-50f, 50f)
                ),
                Rotation = quaternion.identity,
                Scale = 1f
            });
        }
        
        entities.Dispose();
    }
}
```

**Job System + ECS ç¤ºä¾‹**ï¼š
```csharp
using Unity.Burst;
using Unity.Collections;
using Unity.Entities;
using Unity.Jobs;
using Unity.Mathematics;
using Unity.Transforms;

// ä½¿ç”¨ Job çš„ç³»ç»Ÿ
[BurstCompile]
public partial struct JobMovementSystem : ISystem
{
    public void OnCreate(ref SystemState state)
    {
    }

    public void OnDestroy(ref SystemState state)
    {
    }

    [BurstCompile]
    public void OnUpdate(ref SystemState state)
    {
        // åˆ›å»º Job
        var job = new MovementJob
        {
            DeltaTime = SystemAPI.Time.DeltaTime
        };
        
        // è°ƒåº¦ Job
        state.Dependency = job.ScheduleParallel(state.Dependency);
    }
}

[BurstCompile]
public partial struct MovementJob : IJobEntity
{
    public float DeltaTime;
    
    // è‡ªåŠ¨åŒ¹é…å…·æœ‰è¿™äº›ç»„ä»¶çš„å®ä½“
    void Execute(ref LocalTransform transform, in MovementData movement)
    {
        transform.Position += movement.Direction * movement.Speed * DeltaTime;
    }
}
```

**æ‰¹é‡å¤„ç†ç¤ºä¾‹**ï¼š
```csharp
using Unity.Burst;
using Unity.Collections;
using Unity.Entities;
using Unity.Jobs;
using Unity.Mathematics;
using Unity.Transforms;

// é«˜æ•ˆçš„æ‰¹é‡å¤„ç†ç³»ç»Ÿ
[BurstCompile]
public partial struct BatchProcessingSystem : ISystem
{
    private EntityQuery query;
    
    public void OnCreate(ref SystemState state)
    {
        // åˆ›å»ºæŸ¥è¯¢ï¼Œç­›é€‰éœ€è¦å¤„ç†çš„å®ä½“
        query = state.GetEntityQuery(
            ComponentType.ReadOnly<MovementData>(),
            ComponentType.ReadWrite<LocalTransform>()
        );
    }

    public void OnDestroy(ref SystemState state)
    {
    }

    [BurstCompile]
    public void OnUpdate(ref SystemState state)
    {
        // è·å–ç»„ä»¶æ•°ç»„ï¼ˆè¿ç»­å†…å­˜å¸ƒå±€ï¼‰
        var transforms = query.ToComponentDataArray<LocalTransform>(Allocator.TempJob);
        var movements = query.ToComponentDataArray<MovementData>(Allocator.TempJob);
        
        // åˆ›å»º Job
        var job = new BatchMovementJob
        {
            Transforms = transforms,
            Movements = movements,
            DeltaTime = SystemAPI.Time.DeltaTime
        };
        
        // è°ƒåº¦å¹¶è¡Œ Job
        state.Dependency = job.Schedule(transforms.Length, 64, state.Dependency);
        state.Dependency.Complete();
        
        // å°†ç»“æœå†™å›
        query.CopyFromComponentDataArray(transforms);
        
        transforms.Dispose();
        movements.Dispose();
    }
}

[BurstCompile]
public struct BatchMovementJob : IJobParallelFor
{
    public NativeArray<LocalTransform> Transforms;
    [ReadOnly] public NativeArray<MovementData> Movements;
    public float DeltaTime;
    
    public void Execute(int index)
    {
        var transform = Transforms[index];
        var movement = Movements[index];
        
        transform.Position += movement.Direction * movement.Speed * DeltaTime;
        Transforms[index] = transform;
    }
}
```

**å®ç°è¯´æ˜**ï¼š
1. **IComponentData**ï¼šå®šä¹‰ç»„ä»¶æ•°æ®ï¼Œçº¯æ•°æ®ç»“æ„
2. **ISystem**ï¼šå®šä¹‰ç³»ç»Ÿè¡Œä¸ºï¼Œå¤„ç†é€»è¾‘
3. **IJobEntity**ï¼šç®€åŒ– Job ç¼–å†™ï¼Œè‡ªåŠ¨åŒ¹é…ç»„ä»¶
4. **EntityQuery**ï¼šé«˜æ•ˆç­›é€‰å®ä½“ï¼Œæ‰¹é‡å¤„ç†

### 3. æ³¨æ„äº‹é¡¹
**å…³é”®è¦ç‚¹**ï¼š
- ğŸ“Œ **æ•°æ®å¸ƒå±€**ï¼šECS ä½¿ç”¨ SoAï¼ˆStructure of Arraysï¼‰å¸ƒå±€ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡
- ğŸ“Œ **ç»„ä»¶é™åˆ¶**ï¼šç»„ä»¶å¿…é¡»æ˜¯å€¼ç±»å‹ï¼ˆstructï¼‰ï¼Œä¸èƒ½åŒ…å«å¼•ç”¨ç±»å‹
- ğŸ“Œ **ç³»ç»Ÿæ›´æ–°**ï¼šæ³¨æ„ç³»ç»Ÿä¾èµ–å…³ç³»ï¼Œé¿å…ç«äº‰æ¡ä»¶

**ä¼˜åŒ–å»ºè®®**ï¼š
- ğŸš€ ä½¿ç”¨ `EntityQuery` æ‰¹é‡å¤„ç†ï¼Œå‡å°‘éå†å¼€é”€
- ğŸš€ åˆç†ä½¿ç”¨ `[BurstCompile]` å’Œ `Unity.Mathematics`
- ğŸš€ é¿å…åœ¨ ECS ä¸­ä½¿ç”¨è™šå‡½æ•°å’Œæ¥å£

**è®°å¿†è¦ç‚¹**ï¼š
- DOTS = ECS + Job System + Burst
- æ•°æ®ä¸é€»è¾‘åˆ†ç¦»ï¼Œç¼“å­˜å‹å¥½
- æ‰¹é‡å¤„ç†ï¼Œå¹¶è¡Œè®¡ç®—

### 4. å®ç°åŸç†
**åº•å±‚å®ç°**ï¼š
- **ECS æ¶æ„**ï¼šEntityï¼ˆIDï¼‰+ Componentï¼ˆæ•°æ®ï¼‰+ Systemï¼ˆé€»è¾‘ï¼‰
- **Archetype**ï¼šå…·æœ‰ç›¸åŒç»„ä»¶ç»„åˆçš„å®ä½“å…±äº«å†…å­˜å¸ƒå±€
- **Chunk**ï¼šå›ºå®šå¤§å°çš„å†…å­˜å—ï¼Œå­˜å‚¨åŒç±»å‹å®ä½“æ•°æ®

**Unityå¼•æ“åˆ†æ**ï¼š
- **World**ï¼šåŒ…å«æ‰€æœ‰å®ä½“å’Œç³»ç»Ÿçš„å®¹å™¨
- **EntityManager**ï¼šç®¡ç†å®ä½“çš„åˆ›å»ºã€é”€æ¯å’Œç»„ä»¶æ“ä½œ
- **SystemGroup**ï¼šç»„ç»‡ç³»ç»Ÿæ‰§è¡Œé¡ºåº

**ä¸»è¦æ¥å£å’ŒAPI**ï¼š
- `IComponentData`ï¼šç»„ä»¶æ¥å£
- `ISystem`ï¼šç³»ç»Ÿæ¥å£
- `EntityManager`ï¼šå®ä½“ç®¡ç†å™¨
- `SystemAPI.Query`ï¼šç»„ä»¶æŸ¥è¯¢
- `EntityQuery`ï¼šå®ä½“æŸ¥è¯¢

**æ ¸å¿ƒæ‰§è¡Œæµç¨‹**ï¼š
1. **åˆ›å»º World**ï¼šåˆå§‹åŒ– ECS ä¸–ç•Œ
2. **å®šä¹‰ç»„ä»¶**ï¼šåˆ›å»ºæ•°æ®ç»“æ„
3. **åˆ›å»ºç³»ç»Ÿ**ï¼šå®ç°ä¸šåŠ¡é€»è¾‘
4. **åˆ›å»ºå®ä½“**ï¼šå®ä¾‹åŒ–æ¸¸æˆå¯¹è±¡
5. **ç³»ç»Ÿæ›´æ–°**ï¼šæ¯å¸§æ‰§è¡Œç³»ç»Ÿé€»è¾‘

### 5. çŸ¥è¯†ç‚¹æ€»ç»“
**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- DOTS æ˜¯ Unity çš„é«˜æ€§èƒ½ç¼–ç¨‹æ¡†æ¶
- ECS æ¶æ„ï¼šæ•°æ®ä¸é€»è¾‘åˆ†ç¦»
- é¢å‘æ•°æ®è®¾è®¡ï¼Œä¼˜åŒ–ç¼“å­˜è®¿é—®

**æŠ€æœ¯è¦ç‚¹**ï¼š
- ä½¿ç”¨ `IComponentData` å®šä¹‰ç»„ä»¶
- ä½¿ç”¨ `ISystem` å®šä¹‰ç³»ç»Ÿ
- ä½¿ç”¨ `EntityQuery` é«˜æ•ˆæŸ¥è¯¢
- ç»“åˆ Job System å’Œ Burst Compiler

**åº”ç”¨åœºæ™¯**ï¼š
- å¤§è§„æ¨¡æ¨¡æ‹Ÿï¼ˆä¸‡äººåŒå±ï¼‰
- å¤æ‚ç‰©ç†æ¨¡æ‹Ÿ
- ç¨‹åºåŒ–ç”Ÿæˆ
- é«˜æ€§èƒ½ AI
- ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–

**å­¦ä¹ å»ºè®®**ï¼š
- ä»ç®€å• ECS é¡¹ç›®å¼€å§‹
- å­¦ä¹ æ•°æ®å¯¼å‘è®¾è®¡ï¼ˆDODï¼‰ç†å¿µ
- äº†è§£ CPU ç¼“å­˜å’Œå†…å­˜å¸ƒå±€
- å‚è€ƒ Unity ECS Samples

### 6. ç½‘ç»œæœç´¢ç»“æœ
**ç›¸å…³èµ„æ–™**ï¼š
- Unityå®˜æ–¹æ–‡æ¡£ï¼š[ECS](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/index.html)
- Unity Learnï¼š[DOTS Learning Path](https://learn.unity.com/pathway/dots)
- GitHubï¼š[Unity ECS Samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples)

**ä¿¡æ¯éªŒè¯**ï¼š
- DOTS æ˜¯ Unity å®˜æ–¹ä¸»æ¨çš„é«˜æ€§èƒ½æ–¹æ¡ˆ
- ECS æ¶æ„åœ¨æ¸¸æˆè¡Œä¸šå¹¿æ³›åº”ç”¨
- æ€§èƒ½æå‡æ•°æ®ç»è¿‡å®˜æ–¹éªŒè¯

**æƒå¨æ¥æº**ï¼š
- Unity Technologies. (2026). Entities Package Documentation.
- Unity Technologies. (2026). DOTS Best Practices.
- GDC Vault. (2026). Data-Oriented Design in Games.
