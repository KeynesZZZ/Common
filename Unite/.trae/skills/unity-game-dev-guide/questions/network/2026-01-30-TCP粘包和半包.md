---
title: "TCPç²˜åŒ…å’ŒåŠåŒ…"
date: "2026-01-30 10:30:00"
tags: [Unity, ç½‘ç»œç¼–ç¨‹, TCP, ç²˜åŒ…, åŠåŒ…]
difficulty: "åŸºç¡€"
topic: "ç½‘ç»œç¼–ç¨‹"
project: "å¤šäººåœ¨çº¿æ¸¸æˆ"
skill_level: "åˆçº§"
---

# TCPç²˜åŒ…å’ŒåŠåŒ…

## é—®é¢˜æè¿°
> è¯·è¯¦ç»†è§£é‡ŠTCPç²˜åŒ…å’ŒåŠåŒ…çš„åŸå› ï¼Œä»¥åŠåœ¨æ¸¸æˆå¼€å‘ä¸­å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚

## å›ç­”

### 1. é—®é¢˜åˆ†æ
**æŠ€æœ¯èƒŒæ™¯**ï¼š
- TCPæ˜¯ä¸€ç§é¢å‘å­—èŠ‚æµçš„åè®®ï¼Œå®ƒå°†åº”ç”¨å±‚æ•°æ®è§†ä¸ºå­—èŠ‚æµï¼Œä¸ä¿ç•™æ¶ˆæ¯è¾¹ç•Œ
- åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å‘é€ç»“æ„åŒ–çš„æ¶ˆæ¯ï¼Œä½†TCPçš„å­—èŠ‚æµç‰¹æ€§å¯èƒ½å¯¼è‡´æ¶ˆæ¯è¾¹ç•Œä¸¢å¤±
- è¿™ä¼šå¯¼è‡´æ¥æ”¶æ–¹æ— æ³•æ­£ç¡®è§£ææ¶ˆæ¯ï¼Œå½±å“æ¸¸æˆé€»è¾‘çš„æ‰§è¡Œ

**æ ¹æœ¬åŸå› **ï¼š
- **ç²˜åŒ…**ï¼šå¤šä¸ªå°æ¶ˆæ¯è¢«åˆå¹¶åœ¨ä¸€ä¸ªTCPæ•°æ®åŒ…ä¸­å‘é€
- **åŠåŒ…**ï¼šä¸€ä¸ªå¤§æ¶ˆæ¯è¢«åˆ†å‰²æˆå¤šä¸ªTCPæ•°æ®åŒ…å‘é€ï¼Œæ¥æ”¶æ–¹åªæ”¶åˆ°éƒ¨åˆ†æ•°æ®
- è¿™äº›é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯TCPçš„Nagleç®—æ³•å’Œæ»‘åŠ¨çª—å£æœºåˆ¶ï¼Œä»¥åŠç½‘ç»œå±‚çš„MTUé™åˆ¶

**è§£å†³æ–¹æ¡ˆæ¦‚è¿°**ï¼š
- å®ç°æ¶ˆæ¯è¾¹ç•Œæ ‡è®°ï¼Œå¦‚é•¿åº¦å‰ç¼€æ³•ã€åˆ†éš”ç¬¦æ³•ç­‰
- ä½¿ç”¨åˆé€‚çš„åºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹æ³•
- è®¾è®¡å¥å£®çš„æ¶ˆæ¯è§£æé€»è¾‘
- æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

**æŠ€æœ¯éš¾åº¦**ï¼šåŸºç¡€
**é€‚ç”¨åœºæ™¯**ï¼šæ‰€æœ‰ä½¿ç”¨TCPè¿›è¡Œé€šä¿¡çš„æ¸¸æˆç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯éœ€è¦ä¼ è¾“ç»“æ„åŒ–æ•°æ®çš„åœºæ™¯
**å…³è”é¡¹ç›®**ï¼šå¤šäººåœ¨çº¿æ¸¸æˆã€å®æ—¶é€šä¿¡ç³»ç»Ÿã€æ•°æ®åŒæ­¥ç³»ç»Ÿ

### 2. æ¡ˆä¾‹æ¼”ç¤º

#### ç²˜åŒ…å’ŒåŠåŒ…çš„åŸå› 
**ç²˜åŒ…åŸå› **ï¼š
1. **Nagleç®—æ³•**ï¼šTCPé»˜è®¤å¯ç”¨Nagleç®—æ³•ï¼Œä¼šåˆå¹¶å°æ•°æ®åŒ…ä»¥æé«˜ç½‘ç»œæ•ˆç‡
2. **åº”ç”¨å±‚å‘é€é¢‘ç‡**ï¼šåº”ç”¨å±‚è¿ç»­å‘é€å¤šä¸ªå°æ¶ˆæ¯ï¼ŒTCPå¯èƒ½å°†å®ƒä»¬åˆå¹¶å‘é€
3. **ç½‘ç»œæ‹¥å¡**ï¼šç½‘ç»œæ‹¥å¡æ—¶ï¼ŒTCPä¼šå»¶è¿Ÿå‘é€æ•°æ®ï¼Œå¯¼è‡´å¤šä¸ªæ¶ˆæ¯è¢«åˆå¹¶

**åŠåŒ…åŸå› **ï¼š
1. **MTUé™åˆ¶**ï¼šç½‘ç»œå±‚çš„MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰é™åˆ¶äº†å•ä¸ªæ•°æ®åŒ…çš„å¤§å°
2. **æ¥æ”¶ç¼“å†²åŒº**ï¼šæ¥æ”¶æ–¹çš„ç¼“å†²åŒºå¤§å°ä¸è¶³ï¼Œå¯¼è‡´åªèƒ½æ¥æ”¶éƒ¨åˆ†æ•°æ®
3. **ç½‘ç»œåˆ†ç‰‡**ï¼šæ•°æ®åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­è¢«åˆ†ç‰‡

**ç¤ºæ„å›¾**ï¼š
```
å‘é€æ–¹åº”ç”¨å±‚ï¼š  [æ¶ˆæ¯1] [æ¶ˆæ¯2] [æ¶ˆæ¯3]
TCPå±‚ï¼š        [æ¶ˆæ¯1+æ¶ˆæ¯2] [æ¶ˆæ¯3]  // ç²˜åŒ…

å‘é€æ–¹åº”ç”¨å±‚ï¼š  [å¤§æ¶ˆæ¯A]
TCPå±‚ï¼š        [å¤§æ¶ˆæ¯Aéƒ¨åˆ†1] [å¤§æ¶ˆæ¯Aéƒ¨åˆ†2]  // åŠåŒ…
```

#### è§£å†³æ–¹æ¡ˆï¼šé•¿åº¦å‰ç¼€æ³•
**ä»£ç ç¤ºä¾‹**ï¼š

**æ¶ˆæ¯å‘é€å™¨**ï¼š
```csharp
using System;
using System.IO;
using System.Net.Sockets;
using System.Text;

public class MessageSender
{
    private NetworkStream stream;
    
    public MessageSender(NetworkStream stream)
    {
        this.stream = stream;
    }
    
    public void SendMessage(string message)
    {
        // å°†æ¶ˆæ¯è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
        byte[] messageBytes = Encoding.UTF8.GetBytes(message);
        
        // è®¡ç®—æ¶ˆæ¯é•¿åº¦ï¼ˆ4å­—èŠ‚ï¼‰
        byte[] lengthBytes = BitConverter.GetBytes(messageBytes.Length);
        
        // æ„å»ºå®Œæ•´æ•°æ®åŒ…ï¼šé•¿åº¦å‰ç¼€ + æ¶ˆæ¯å†…å®¹
        byte[] packet = new byte[lengthBytes.Length + messageBytes.Length];
        Buffer.BlockCopy(lengthBytes, 0, packet, 0, lengthBytes.Length);
        Buffer.BlockCopy(messageBytes, 0, packet, lengthBytes.Length, messageBytes.Length);
        
        // å‘é€æ•°æ®åŒ…
        stream.Write(packet, 0, packet.Length);
        stream.Flush();
    }
    
    public void SendMessage<T>(T message, Func<T, byte[]> serializer)
    {
        // ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–å™¨
        byte[] messageBytes = serializer(message);
        
        // è®¡ç®—æ¶ˆæ¯é•¿åº¦ï¼ˆ4å­—èŠ‚ï¼‰
        byte[] lengthBytes = BitConverter.GetBytes(messageBytes.Length);
        
        // æ„å»ºå®Œæ•´æ•°æ®åŒ…
        byte[] packet = new byte[lengthBytes.Length + messageBytes.Length];
        Buffer.BlockCopy(lengthBytes, 0, packet, 0, lengthBytes.Length);
        Buffer.BlockCopy(messageBytes, 0, packet, lengthBytes.Length, messageBytes.Length);
        
        // å‘é€æ•°æ®åŒ…
        stream.Write(packet, 0, packet.Length);
        stream.Flush();
    }
}
```

**æ¶ˆæ¯æ¥æ”¶å™¨**ï¼š
```csharp
using System;
using System.IO;
using System.Net.Sockets;
using System.Text;

public class MessageReceiver
{
    private NetworkStream stream;
    private byte[] buffer = new byte[4096];
    private MemoryStream messageBuffer = new MemoryStream();
    private int messageLength = -1;
    
    public MessageReceiver(NetworkStream stream)
    {
        this.stream = stream;
    }
    
    public string ReceiveMessage()
    {
        while (true)
        {
            // è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº
            int bytesRead = stream.Read(buffer, 0, buffer.Length);
            if (bytesRead == 0)
            {
                // è¿æ¥å…³é—­
                return null;
            }
            
            // å°†è¯»å–çš„æ•°æ®å†™å…¥æ¶ˆæ¯ç¼“å†²åŒº
            messageBuffer.Write(buffer, 0, bytesRead);
            
            // å°è¯•è§£ææ¶ˆæ¯
            string message = TryParseMessage();
            if (message != null)
            {
                return message;
            }
        }
    }
    
    public T ReceiveMessage<T>(Func<byte[], T> deserializer)
    {
        while (true)
        {
            // è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº
            int bytesRead = stream.Read(buffer, 0, buffer.Length);
            if (bytesRead == 0)
            {
                // è¿æ¥å…³é—­
                return default;
            }
            
            // å°†è¯»å–çš„æ•°æ®å†™å…¥æ¶ˆæ¯ç¼“å†²åŒº
            messageBuffer.Write(buffer, 0, bytesRead);
            
            // å°è¯•è§£ææ¶ˆæ¯
            byte[] messageBytes = TryParseMessageBytes();
            if (messageBytes != null)
            {
                return deserializer(messageBytes);
            }
        }
    }
    
    private string TryParseMessage()
    {
        // å¦‚æœè¿˜ä¸çŸ¥é“æ¶ˆæ¯é•¿åº¦ï¼Œå°è¯•è¯»å–é•¿åº¦å‰ç¼€
        if (messageLength == -1)
        {
            // ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ•°æ®è¯»å–é•¿åº¦å‰ç¼€ï¼ˆ4å­—èŠ‚ï¼‰
            if (messageBuffer.Length >= 4)
            {
                // è¯»å–é•¿åº¦å‰ç¼€
                byte[] lengthBytes = new byte[4];
                messageBuffer.Position = 0;
                messageBuffer.Read(lengthBytes, 0, 4);
                messageLength = BitConverter.ToInt32(lengthBytes, 0);
                
                // ç§»é™¤é•¿åº¦å‰ç¼€
                byte[] remainingBytes = messageBuffer.ToArray();
                messageBuffer.SetLength(0);
                messageBuffer.Write(remainingBytes, 4, remainingBytes.Length - 4);
            }
            else
            {
                // æ•°æ®ä¸è¶³ï¼Œç­‰å¾…æ›´å¤šæ•°æ®
                return null;
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®è¯»å–å®Œæ•´æ¶ˆæ¯
        if (messageBuffer.Length >= messageLength)
        {
            // è¯»å–æ¶ˆæ¯å†…å®¹
            byte[] messageBytes = new byte[messageLength];
            messageBuffer.Position = 0;
            messageBuffer.Read(messageBytes, 0, messageLength);
            
            // ç§»é™¤å·²è¯»å–çš„æ¶ˆæ¯
            byte[] remainingBytes = messageBuffer.ToArray();
            messageBuffer.SetLength(0);
            messageBuffer.Write(remainingBytes, messageLength, remainingBytes.Length - messageLength);
            
            // é‡ç½®æ¶ˆæ¯é•¿åº¦ï¼Œå‡†å¤‡è¯»å–ä¸‹ä¸€æ¡æ¶ˆæ¯
            messageLength = -1;
            
            // å°†æ¶ˆæ¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            return Encoding.UTF8.GetString(messageBytes);
        }
        
        // æ•°æ®ä¸è¶³ï¼Œç­‰å¾…æ›´å¤šæ•°æ®
        return null;
    }
    
    private byte[] TryParseMessageBytes()
    {
        // å¦‚æœè¿˜ä¸çŸ¥é“æ¶ˆæ¯é•¿åº¦ï¼Œå°è¯•è¯»å–é•¿åº¦å‰ç¼€
        if (messageLength == -1)
        {
            // ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ•°æ®è¯»å–é•¿åº¦å‰ç¼€ï¼ˆ4å­—èŠ‚ï¼‰
            if (messageBuffer.Length >= 4)
            {
                // è¯»å–é•¿åº¦å‰ç¼€
                byte[] lengthBytes = new byte[4];
                messageBuffer.Position = 0;
                messageBuffer.Read(lengthBytes, 0, 4);
                messageLength = BitConverter.ToInt32(lengthBytes, 0);
                
                // ç§»é™¤é•¿åº¦å‰ç¼€
                byte[] remainingBytes = messageBuffer.ToArray();
                messageBuffer.SetLength(0);
                messageBuffer.Write(remainingBytes, 4, remainingBytes.Length - 4);
            }
            else
            {
                // æ•°æ®ä¸è¶³ï¼Œç­‰å¾…æ›´å¤šæ•°æ®
                return null;
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®è¯»å–å®Œæ•´æ¶ˆæ¯
        if (messageBuffer.Length >= messageLength)
        {
            // è¯»å–æ¶ˆæ¯å†…å®¹
            byte[] messageBytes = new byte[messageLength];
            messageBuffer.Position = 0;
            messageBuffer.Read(messageBytes, 0, messageLength);
            
            // ç§»é™¤å·²è¯»å–çš„æ¶ˆæ¯
            byte[] remainingBytes = messageBuffer.ToArray();
            messageBuffer.SetLength(0);
            messageBuffer.Write(remainingBytes, messageLength, remainingBytes.Length - messageLength);
            
            // é‡ç½®æ¶ˆæ¯é•¿åº¦ï¼Œå‡†å¤‡è¯»å–ä¸‹ä¸€æ¡æ¶ˆæ¯
            messageLength = -1;
            
            return messageBytes;
        }
        
        // æ•°æ®ä¸è¶³ï¼Œç­‰å¾…æ›´å¤šæ•°æ®
        return null;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```csharp
using System;
using System.Net.Sockets;
using UnityEngine;

public class TCPMessageExample : MonoBehaviour
{
    private TcpClient client;
    private NetworkStream stream;
    private MessageSender sender;
    private MessageReceiver receiver;
    
    [SerializeField] private string serverIP = "127.0.0.1";
    [SerializeField] private int serverPort = 8888;
    
    private void Start()
    {
        ConnectToServer();
    }
    
    private void ConnectToServer()
    {
        try
        {
            client = new TcpClient();
            client.Connect(serverIP, serverPort);
            stream = client.GetStream();
            
            sender = new MessageSender(stream);
            receiver = new MessageReceiver(stream);
            
            Debug.Log("Connected to server successfully!");
            
            // å‘é€æµ‹è¯•æ¶ˆæ¯
            sender.SendMessage("Hello, server!");
            sender.SendMessage("This is a test message.");
            sender.SendMessage("Another message to test packet splitting.");
            
            // å¼€å§‹æ¥æ”¶æ¶ˆæ¯
            StartCoroutine(ReceiveMessages());
        }
        catch (Exception e)
        {
            Debug.LogError("Connection error: " + e.Message);
        }
    }
    
    private System.Collections.IEnumerator ReceiveMessages()
    {
        while (true)
        {
            string message = receiver.ReceiveMessage();
            if (message == null)
            {
                Debug.Log("Connection closed.");
                break;
            }
            Debug.Log("Received: " + message);
            yield return null;
        }
    }
    
    private void OnApplicationQuit()
    {
        if (stream != null)
        {
            stream.Close();
        }
        if (client != null)
        {
            client.Close();
        }
    }
}
```

**æœåŠ¡å™¨ç«¯ç¤ºä¾‹**ï¼š
```csharp
using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;

public class TCPServerWithMessageHandling
{
    private TcpListener listener;
    private bool isRunning = false;
    
    public void StartServer(int port)
    {
        listener = new TcpListener(IPAddress.Any, port);
        listener.Start();
        isRunning = true;
        
        Console.WriteLine("Server started on port " + port);
        
        Thread listenThread = new Thread(ListenForClients);
        listenThread.Start();
    }
    
    private void ListenForClients()
    {
        while (isRunning)
        {
            try
            {
                TcpClient client = listener.AcceptTcpClient();
                Thread clientThread = new Thread(HandleClient);
                clientThread.Start(client);
            }
            catch (Exception e)
            {
                Console.WriteLine("Error accepting client: " + e.Message);
            }
        }
    }
    
    private void HandleClient(object clientObj)
    {
        TcpClient client = (TcpClient)clientObj;
        NetworkStream stream = client.GetStream();
        
        MessageSender sender = new MessageSender(stream);
        MessageReceiver receiver = new MessageReceiver(stream);
        
        Console.WriteLine("Client connected: " + ((IPEndPoint)client.Client.RemoteEndPoint).Address);
        
        try
        {
            while (isRunning)
            {
                string message = receiver.ReceiveMessage();
                if (message == null)
                {
                    break;
                }
                
                Console.WriteLine("Received: " + message);
                
                // å›æ˜¾æ¶ˆæ¯
                sender.SendMessage("Server: " + message);
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Error handling client: " + e.Message);
        }
        finally
        {
            stream.Close();
            client.Close();
            Console.WriteLine("Client disconnected");
        }
    }
    
    public void StopServer()
    {
        isRunning = false;
        if (listener != null)
        {
            listener.Stop();
        }
    }
}
```

**å®ç°è¯´æ˜**ï¼š
- **é•¿åº¦å‰ç¼€æ³•**ï¼šåœ¨æ¯ä¸ªæ¶ˆæ¯å‰æ·»åŠ 4å­—èŠ‚çš„é•¿åº¦å‰ç¼€ï¼ŒæŒ‡ç¤ºæ¶ˆæ¯çš„å®é™…é•¿åº¦
- **æ¶ˆæ¯ç¼“å†²åŒº**ï¼šä½¿ç”¨`MemoryStream`ä½œä¸ºæ¶ˆæ¯ç¼“å†²åŒºï¼Œç´¯ç§¯æ¥æ”¶åˆ°çš„æ•°æ®
- **è§£æé€»è¾‘**ï¼šå…ˆè¯»å–é•¿åº¦å‰ç¼€ï¼Œå†è¯»å–å¯¹åº”é•¿åº¦çš„æ¶ˆæ¯å†…å®¹
- **å¥å£®æ€§**ï¼šå¤„ç†äº†æ•°æ®ä¸è¶³çš„æƒ…å†µï¼Œç¡®ä¿èƒ½å¤Ÿæ­£ç¡®è§£æç²˜åŒ…å’ŒåŠåŒ…

### 3. æ³¨æ„äº‹é¡¹
**å…³é”®è¦ç‚¹**ï¼š
- ğŸ“Œ é•¿åº¦å‰ç¼€çš„å¤§å°ï¼šé€šå¸¸ä½¿ç”¨4å­—èŠ‚ï¼ˆintï¼‰ï¼Œå¯ä»¥è¡¨ç¤ºæœ€å¤§çº¦4GBçš„æ¶ˆæ¯
- ğŸ“Œ å­—èŠ‚åºé—®é¢˜ï¼šåœ¨è·¨å¹³å°é€šä¿¡æ—¶ï¼Œéœ€è¦è€ƒè™‘å­—èŠ‚åºï¼ˆå¤§ç«¯/å°ç«¯ï¼‰é—®é¢˜
- ğŸ“Œ ç¼“å†²åŒºç®¡ç†ï¼šéœ€è¦åˆç†ç®¡ç†ç¼“å†²åŒºå¤§å°ï¼Œé¿å…å†…å­˜æº¢å‡º
- ğŸ“Œ å¼‚å¸¸å¤„ç†ï¼šéœ€è¦å¤„ç†ç½‘ç»œå¼‚å¸¸å’Œæ¶ˆæ¯è§£æé”™è¯¯
- ğŸ“Œ æ€§èƒ½ä¼˜åŒ–ï¼šå¯¹äºé«˜é¢‘æ¶ˆæ¯ï¼Œéœ€è¦è€ƒè™‘è§£ææ€§èƒ½

**ä¼˜åŒ–å»ºè®®**ï¼š
- ğŸš€ é¢„åˆ†é…ç¼“å†²åŒºï¼šé¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾
- ğŸš€ ä½¿ç”¨å¯¹è±¡æ± ï¼šé‡ç”¨æ¶ˆæ¯å¯¹è±¡ï¼Œå‡å°‘GCå‹åŠ›
- ğŸš€ æ‰¹é‡å¤„ç†ï¼šå¯¹äºå¤šä¸ªå°æ¶ˆæ¯ï¼Œå¯ä»¥è€ƒè™‘æ‰¹é‡å‘é€
- ğŸš€ å‹ç¼©æ•°æ®ï¼šå¯¹äºå¤§æ¶ˆæ¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å‹ç¼©ç®—æ³•å‡å°‘ä¼ è¾“å¤§å°
- ğŸš€ ä½¿ç”¨å¼‚æ­¥IOï¼šæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›

**è·¨å¹³å°è€ƒé‡**ï¼š
- ä¸åŒå¹³å°çš„å­—èŠ‚åºå¯èƒ½ä¸åŒï¼Œéœ€è¦ç»Ÿä¸€ä½¿ç”¨å¤§ç«¯æˆ–å°ç«¯
- ç§»åŠ¨å¹³å°çš„ç½‘ç»œç¯å¢ƒä¸ç¨³å®šï¼Œéœ€è¦æ›´å¥å£®çš„é”™è¯¯å¤„ç†
- WebGLå¹³å°çš„TCPå®ç°æœ‰é™åˆ¶ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨WebSocket

**è®°å¿†è¦ç‚¹**ï¼š
- ç²˜åŒ…ï¼šå¤šä¸ªæ¶ˆæ¯è¢«åˆå¹¶ä¸ºä¸€ä¸ªæ•°æ®åŒ…
- åŠåŒ…ï¼šä¸€ä¸ªæ¶ˆæ¯è¢«åˆ†å‰²ä¸ºå¤šä¸ªæ•°æ®åŒ…
- é•¿åº¦å‰ç¼€æ³•ï¼šæœ€å¸¸ç”¨çš„è§£å†³æ–¹æ³•ï¼Œç®€å•å¯é 
- æ¶ˆæ¯ç¼“å†²åŒºï¼šç´¯ç§¯æ•°æ®ï¼Œç¡®ä¿èƒ½å¤Ÿè§£æå®Œæ•´æ¶ˆæ¯
- å­—èŠ‚åºï¼šè·¨å¹³å°é€šä¿¡æ—¶éœ€è¦æ³¨æ„

### 4. å®ç°åŸç†
**åº•å±‚å®ç°**ï¼š
- **æ¶ˆæ¯å¸§**ï¼šå°†åº”ç”¨å±‚æ¶ˆæ¯å°è£…ä¸ºå›ºå®šæ ¼å¼çš„å¸§ï¼ŒåŒ…å«é•¿åº¦å‰ç¼€å’Œæ¶ˆæ¯å†…å®¹
- **æµæ§åˆ¶**ï¼šé€šè¿‡é•¿åº¦å‰ç¼€æ§åˆ¶æ¶ˆæ¯çš„è¾¹ç•Œï¼Œç¡®ä¿æ¥æ”¶æ–¹èƒ½å¤Ÿæ­£ç¡®è§£æ
- **ç¼“å†²åŒºç®¡ç†**ï¼šä½¿ç”¨å†…å­˜æµä½œä¸ºç¼“å†²åŒºï¼Œé«˜æ•ˆå¤„ç†æ•°æ®ç´¯ç§¯å’Œæå–
- **åºåˆ—åŒ–/ååºåˆ—åŒ–**ï¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œæˆ–å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡

**æ ¸å¿ƒæ•°æ®ç»“æ„**ï¼š
```
+----------------+----------------+----------------+
| é•¿åº¦å‰ç¼€ (4B)  | æ¶ˆæ¯ç±»å‹ (å¯é€‰) | æ¶ˆæ¯å†…å®¹ (nB)  |
+----------------+----------------+----------------+
```

**è§£ææµç¨‹**ï¼š
1. **è¯»å–é•¿åº¦å‰ç¼€**ï¼šä»ç¼“å†²åŒºè¯»å–4å­—èŠ‚çš„é•¿åº¦å‰ç¼€
2. **è®¡ç®—æ¶ˆæ¯é•¿åº¦**ï¼šå°†é•¿åº¦å‰ç¼€è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¾—åˆ°æ¶ˆæ¯å†…å®¹çš„é•¿åº¦
3. **ç­‰å¾…å®Œæ•´æ•°æ®**ï¼šæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®
4. **æå–æ¶ˆæ¯å†…å®¹**ï¼šä»ç¼“å†²åŒºæå–å¯¹åº”é•¿åº¦çš„æ¶ˆæ¯å†…å®¹
5. **å¤„ç†å‰©ä½™æ•°æ®**ï¼šå°†å‰©ä½™æ•°æ®ä¿ç•™åœ¨ç¼“å†²åŒºï¼Œç”¨äºè§£æä¸‹ä¸€æ¡æ¶ˆæ¯

**çŠ¶æ€æœºæ¨¡å‹**ï¼š
```
[ç­‰å¾…é•¿åº¦å‰ç¼€] â†’ [è¯»å–é•¿åº¦å‰ç¼€] â†’ [ç­‰å¾…æ¶ˆæ¯å†…å®¹] â†’ [è¯»å–æ¶ˆæ¯å†…å®¹] â†’ [å¤„ç†æ¶ˆæ¯] â†’ [ç­‰å¾…é•¿åº¦å‰ç¼€]
```

### 5. çŸ¥è¯†ç‚¹æ€»ç»“
**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- TCPçš„å­—èŠ‚æµç‰¹æ€§ï¼šTCPå°†æ•°æ®è§†ä¸ºå­—èŠ‚æµï¼Œä¸ä¿ç•™æ¶ˆæ¯è¾¹ç•Œ
- ç²˜åŒ…å’ŒåŠåŒ…ï¼šTCPä¼ è¾“ä¸­çš„å¸¸è§é—®é¢˜ï¼Œéœ€è¦åº”ç”¨å±‚è§£å†³
- æ¶ˆæ¯è¾¹ç•Œï¼šé€šè¿‡é•¿åº¦å‰ç¼€ã€åˆ†éš”ç¬¦ç­‰æ–¹å¼æ ‡è®°æ¶ˆæ¯è¾¹ç•Œ
- åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œæˆ–å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡
- ç¼“å†²åŒºç®¡ç†ï¼šé«˜æ•ˆå¤„ç†æ•°æ®ç´¯ç§¯å’Œæå–

**æŠ€æœ¯è¦ç‚¹**ï¼š
- é•¿åº¦å‰ç¼€æ³•çš„å®ç°å’Œä½¿ç”¨
- æ¶ˆæ¯ç¼“å†²åŒºçš„è®¾è®¡å’Œç®¡ç†
- åºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹æ³•çš„é€‰æ‹©
- è·¨å¹³å°é€šä¿¡çš„æ³¨æ„äº‹é¡¹
- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**åº”ç”¨åœºæ™¯**ï¼š
- å¤šäººåœ¨çº¿æ¸¸æˆçš„èŠå¤©ç³»ç»Ÿ
- å®æ—¶æˆ˜ç•¥æ¸¸æˆçš„å‘½ä»¤ä¼ è¾“
- MMOæ¸¸æˆçš„çŠ¶æ€åŒæ­¥
- ä»»ä½•éœ€è¦å¯é ä¼ è¾“ç»“æ„åŒ–æ•°æ®çš„åœºæ™¯

**å­¦ä¹ å»ºè®®**ï¼š
- æ·±å…¥ç†è§£TCPçš„ä¼ è¾“æœºåˆ¶å’Œç‰¹æ€§
- å­¦ä¹ ä¸åŒçš„æ¶ˆæ¯è¾¹ç•Œæ ‡è®°æ–¹æ³•
- å®è·µç¼–å†™å®Œæ•´çš„æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ä»£ç 
- æµ‹è¯•åœ¨ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹çš„æ€§èƒ½å’Œå¯é æ€§
- äº†è§£å¸¸è§çš„åºåˆ—åŒ–åº“ï¼Œå¦‚Protobufã€MessagePackç­‰

**è¿›é˜¶è·¯å¾„**ï¼š
- å­¦ä¹ ä½¿ç”¨ä¸“ä¸šçš„ç½‘ç»œåº“ï¼Œå¦‚Mirrorã€Photonç­‰
- ç ”ç©¶UDPçš„å¯é ä¼ è¾“å®ç°
- è®¾è®¡æ›´å¤æ‚çš„æ¶ˆæ¯åè®®ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶å’Œæ‰©å±•
- å®ç°åŠ å¯†å’Œè®¤è¯æœºåˆ¶ï¼Œæé«˜å®‰å…¨æ€§
- ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼Œå‡å°‘å»¶è¿Ÿå’Œå¸¦å®½ä½¿ç”¨

### 6. é¡¹ç›®å®è·µ
**é¡¹ç›®æ¡ˆä¾‹**ï¼š
- **å®æ—¶å¤šäººæ¸¸æˆ**ï¼šä½¿ç”¨é•¿åº¦å‰ç¼€æ³•ä¼ è¾“ç©å®¶è¾“å…¥å’Œæ¸¸æˆçŠ¶æ€
- **èŠå¤©ç³»ç»Ÿ**ï¼šä½¿ç”¨é•¿åº¦å‰ç¼€æ³•ä¼ è¾“èŠå¤©æ¶ˆæ¯å’Œè¡¨æƒ…
- **äº¤æ˜“ç³»ç»Ÿ**ï¼šä½¿ç”¨é•¿åº¦å‰ç¼€æ³•ä¼ è¾“äº¤æ˜“è¯·æ±‚å’Œç¡®è®¤
- **æ’è¡Œæ¦œç³»ç»Ÿ**ï¼šä½¿ç”¨é•¿åº¦å‰ç¼€æ³•ä¼ è¾“æ’åæ•°æ®

**å¼€å‘æµç¨‹**ï¼š
1. **åè®®è®¾è®¡**ï¼šè®¾è®¡æ¶ˆæ¯æ ¼å¼å’Œç±»å‹
2. **å®ç°åŸºç¡€æ¡†æ¶**ï¼šå®ç°æ¶ˆæ¯å‘é€å’Œæ¥æ”¶çš„åŸºç¡€æ¡†æ¶
3. **æµ‹è¯•éªŒè¯**ï¼šåœ¨ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹æµ‹è¯•å¯é æ€§
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–ç¼“å†²åŒºç®¡ç†å’Œåºåˆ—åŒ–æ€§èƒ½
5. **é›†æˆåº”ç”¨**ï¼šå°†æ¶ˆæ¯ç³»ç»Ÿé›†æˆåˆ°æ¸¸æˆä¸­

**æœ€ä½³å®è·µ**ï¼š
- **åè®®ç‰ˆæœ¬æ§åˆ¶**ï¼šåœ¨æ¶ˆæ¯æ ¼å¼ä¸­åŒ…å«ç‰ˆæœ¬å·ï¼Œæ”¯æŒåè®®å‡çº§
- **æ¶ˆæ¯ç±»å‹**ï¼šåœ¨æ¶ˆæ¯ä¸­åŒ…å«ç±»å‹å­—æ®µï¼Œæ–¹ä¾¿è·¯ç”±å’Œå¤„ç†
- **é”™è¯¯å¤„ç†**ï¼šå®ç°å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®š
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•å…³é”®çš„ç½‘ç»œäº‹ä»¶å’Œé”™è¯¯ï¼Œä¾¿äºè°ƒè¯•
- **ç›‘æ§ç»Ÿè®¡**ï¼šç»Ÿè®¡æ¶ˆæ¯ååé‡å’Œå»¶è¿Ÿï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½

### 7. ç½‘ç»œæœç´¢ç»“æœ
**ç›¸å…³èµ„æ–™**ï¼š
- TCP/IPåè®®è¯¦è§£ï¼ˆå·1ï¼šåè®®ï¼‰- ç†æŸ¥å¾·Â·å²è’‚æ–‡æ–¯
- æ¸¸æˆç½‘ç»œç¼–ç¨‹ç²¾è¦ - Glenn Fiedler
- Microsoft Docsï¼šNetworkStreamç±»
- å„ç§åºåˆ—åŒ–åº“çš„æ–‡æ¡£ï¼šProtobufã€MessagePackç­‰

**ä¿¡æ¯éªŒè¯**ï¼š
- é•¿åº¦å‰ç¼€æ³•æ˜¯è§£å†³TCPç²˜åŒ…å’ŒåŠåŒ…é—®é¢˜çš„æ ‡å‡†æ–¹æ³•
- ä»£ç ç¤ºä¾‹åŸºäºMicrosoftå®˜æ–¹æ–‡æ¡£å’Œæ¸¸æˆå¼€å‘å®è·µ
- ä¼˜åŒ–å»ºè®®æ¥è‡ªç½‘ç»œç¼–ç¨‹ç¤¾åŒºçš„æœ€ä½³å®è·µ

**æƒå¨æ¥æº**ï¼š
- IETF RFC 793ï¼šTransmission Control Protocol
- Microsoft Docsï¼šhttps://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.networkstream
- Unity Documentationï¼šhttps://docs.unity3d.com/Manual/UNet.html